<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://stackpath.bootstrapcdn.com/bootswatch/4.5.0/sandstone/bootstrap.min.css" rel="stylesheet" type="text/css">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/styles/solarized-light.min.css" rel="stylesheet" type="text/css">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/ag-grid/24.0.0/styles/ag-grid.min.css" rel="stylesheet" type="text/css">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/ag-grid/24.0.0/styles/ag-theme-balham.min.css" rel="stylesheet" type="text/css">
        <link href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" rel="stylesheet" type="text/css">
    </head>
    <body>
        <p id="loading">Loading ...</p>
        <div id="app"></div>
    </body>
    <script src="https://cdn.jsdelivr.net/gh/scicloj/gorilla-notes@master/dist/0.5.1/main.js"></script>
    <script>
     shadow.loader.load("main");
     gorilla_notes.main.main_BANG_(false, "{:options {:reverse-notes? false, :header? false, :notes-in-cards? false, :initially-collapse? false, :auto-scroll? false, :custom-header [:div {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} \"(notespace)\" [:p \"Sat Jan 23 23:17:51 IST 2021\"] nil [:hr]], :custom-footer [:div [:hr] [:hr]]}, :ids [\"39\" \"40\" \"41\" \"42\" \"43\" \"44\" \"45\" \"46\" \"47\" \"48\" \"49\" \"50\" \"51\" \"52\" \"53\" \"54\" \"55\" \"56\" \"57\" \"58\" \"59\" \"60\" \"61\" \"62\" \"63\" \"64\" \"65\" \"66\" \"67\" \"68\" \"69\" \"70\" \"71\" \"72\" \"73\" \"74\" \"75\"], :id->content {\"58\" [:div [:p/code {:code \"(row-numbers-of-last-few-days-by-argfilter\\n datetime20\\n 5)\", :bg-class \"bg-light\"}] [:div [:p/code {:code \"#list<int32>[4]\\n[17, 18, 19, 20, ]\\n\"}]]], \"51\" [:div nil [:div [:p/markdown \"Given a point in time, we want to find the row-numbers of the last few days.\"]]], \"50\" [:div [:p/code {:code \"milliseconds-in-an-day\", :bg-class \"bg-light\"}] [:div [:p/code {:code \"86400000\\n\"}]]], \"69\" [:div nil [:div [:p/markdown \"For every moment in time, we will compute the average of the `:x` column valeus at the last 5 days. Then, we will compute the standard deviation of all these averages.\"]]], \"49\" [:div [:p/code {:code \"(def milliseconds-in-an-day (* 24 60 60 1000))\", :bg-class \"bg-light\"}] [:div nil]], \"60\" [:div nil [:div [:p/markdown \"Now, let us do the same using an index structure.\"]]], \"59\" [:div nil [:div [:p/markdown \"You can verify by looking at the dataset above.\"]]], \"61\" [:div [:p/code {:code \"(def index\\n  (TreeMap. ^java.util.Map\\n            (zipmap (dtype/emap datetime/local-date-time->milliseconds-since-epoch\\n                                :int64\\n                                (:datetime ds))\\n                    (dtype/make-reader :int64 n idx))))\", :bg-class \"bg-light\"}] [:div nil]], \"57\" [:div nil [:div [:p/markdown \"What row numbers are relevant for the last 5 with respect to that instance?\"]]], \"68\" [:div nil [:div [:p/markdown \"## Computing a rolling time window average\"]]], \"67\" [:div [:p/code {:code \"(compute-with-time-measurement #(Thread/sleep 1000))\", :bg-class \"bg-light\"}] [:div [:p/code {:code \"{:result nil, :duration 1000}\\n\"}]]], \"47\" [:div [:p/code {:code \"^kind/dataset\\nds\", :bg-class \"bg-light\"}] [:div [:div {:class \"table table-striped table-hover table-condensed table-responsive\", :style {:height \"400px\"}} [:p/markdown \"_unnamed [10000 3]:\\n\\n|           :datetime |         :x | :i |\\n|---------------------|------------|----|\\n| 1970-01-01T21:25:43 | 0.96076778 |  0 |\\n| 1970-01-02T04:55:08 | 0.11035462 |  1 |\\n| 1970-01-02T16:00:38 | 0.68314497 |  2 |\\n| 1970-01-03T01:43:14 | 0.90543157 |  3 |\\n| 1970-01-08T01:52:44 | 0.64046991 |  4 |\\n| 1970-01-11T00:04:27 | 0.21138051 |  5 |\\n| 1970-01-11T16:42:16 | 0.89785003 |  6 |\\n| 1970-01-15T05:26:22 | 0.78413282 |  7 |\\n| 1970-01-16T09:19:35 | 0.68394494 |  8 |\\n| 1970-01-17T00:00:06 | 0.12143145 |  9 |\\n| 1970-01-19T17:51:39 | 0.00658848 | 10 |\\n| 1970-01-20T12:04:41 | 0.00772899 | 11 |\\n|    1970-01-23T01:47 | 0.57687855 | 12 |\\n| 1970-01-25T01:10:21 | 0.21973514 | 13 |\\n| 1970-01-25T09:29:38 | 0.70902886 | 14 |\\n| 1970-01-25T19:58:24 | 0.23055682 | 15 |\\n| 1970-01-26T06:26:18 | 0.81237636 | 16 |\\n| 1970-01-31T11:36:31 | 0.10319027 | 17 |\\n| 1970-01-31T12:02:19 | 0.35067094 | 18 |\\n| 1970-01-31T22:54:20 | 0.28448423 | 19 |\\n| 1970-01-31T23:24:55 | 0.90061304 | 20 |\\n| 1970-02-03T00:10:25 | 0.98863297 | 21 |\\n| 1970-02-03T21:18:05 | 0.15065412 | 22 |\\n| 1970-02-04T21:23:38 | 0.97544150 | 23 |\\n| 1970-02-05T08:08:15 | 0.31206088 | 24 |\\n\"]]]], \"73\" [:div [:p/code {:code \"(compute-with-time-measurement\\n (fn []\\n   (->> ds\\n        :datetime\\n        (dtype/emap (fn [datetime]\\n                      (let [row-numbers (row-numbers-of-last-few-days-by-index\\n                                         datetime\\n                                         5)]\\n                        (-> ds\\n                            (tablecloth/select-rows row-numbers)\\n                            :x\\n                            fun/mean)))\\n                    :float64)\\n        fun/standard-deviation)))\", :bg-class \"bg-light\"}] [:div [:p/code {:code \"{:result 0.13952006841716494, :duration 188}\\n\"}]]], \"42\" [:div nil [:div [:p/markdown \"## Example data\"]]], \"66\" [:div [:p/code {:code \"(defn compute-with-time-measurement [f]\\n  (let [start-time (datetime/instant)\\n        result (f)\\n        end-time (datetime/instant)]\\n    {:result result\\n     :duration (datetime/between start-time end-time :milliseconds)}))\", :bg-class \"bg-light\"}] [:div nil]], \"44\" [:div [:p/code {:code \"(defn random-datetime []\\n  (datetime/milliseconds->datetime :local-date-time\\n                                   (* 1000 (rand-int 999999999))))\", :bg-class \"bg-light\"}] [:div nil]], \"48\" [:div nil [:div [:p/markdown \"## Finding the row-numbers of the last few days\"]]], \"53\" [:div [:p/code {:code \"(defn row-numbers-of-last-few-days-by-argfilter [reference-datetime num-days]\\n  (let [end   (datetime/local-date-time->milliseconds-since-epoch\\n               reference-datetime)\\n        start (- end\\n                 (* num-days milliseconds-in-an-day))]\\n    (->> ds\\n         :datetime\\n         (argops/argfilter (fn [datetime]\\n                             (<= start\\n                                 (datetime/local-date-time->milliseconds-since-epoch\\n                                  datetime)\\n                                 end))))))\", :bg-class \"bg-light\"}] [:div nil]], \"62\" [:div [:p/code {:code \"(defn row-numbers-of-last-few-days-by-index [reference-datetime num-days]\\n  (let [end   (datetime/local-date-time->milliseconds-since-epoch\\n               reference-datetime)\\n        start (- end\\n                 (* num-days milliseconds-in-an-day))]\\n    (-> (.subMap ^TreeMap\\n                 index\\n                 start\\n                 true\\n                 end\\n                 true)\\n        (.values))))\", :bg-class \"bg-light\"}] [:div nil]], \"75\" [:div nil [:div [:p/markdown \"Same result, different durations. The computational complexities are of order `n^2` and `n*log(n)`, resepectively, with respect to the data size `n`.\"]]], \"70\" [:div nil [:div [:p/markdown \"First, let us do it in the argfilter way.\"]]], \"39\" [:div nil [:div [:p/markdown \"# Rolling time-window -- checking different implementations\"]]], \"63\" [:div nil [:div [:p/markdown \"Checking the same example:\"]]], \"43\" [:div [:p/code {:code \"(def n 10000)\", :bg-class \"bg-light\"}] [:div nil]], \"74\" [:div nil [:div [:p/markdown \"## Conclusion\"]]], \"46\" [:div [:p/code {:code \"(def ds\\n  (-> {:datetime (dtype/make-reader :local-date-time n (random-datetime))\\n       :x        (dtype/make-reader :float64 n (rand))}\\n      tablecloth/dataset\\n      (tablecloth/order-by :datetime)\\n      (tablecloth/add-or-replace-column :i (dtype/make-reader :int64 n idx))))\", :bg-class \"bg-light\"}] [:div nil]], \"45\" [:div [:p/code {:code \"(random-datetime)\", :bg-class \"bg-light\"}] [:div [:p/code {:code \"#object[java.time.LocalDateTime 0x5475ccd4 \\\"1980-05-19T07:38:40\\\"]\\n\"}]]], \"56\" [:div [:p/code {:code \"datetime20\", :bg-class \"bg-light\"}] [:div [:p/code {:code \"#object[java.time.LocalDateTime 0x17f81fe5 \\\"1970-01-31T23:24:55\\\"]\\n\"}]]], \"55\" [:div [:p/code {:code \"(def datetime20\\n  (-> ds\\n      :datetime\\n      (nth 20)))\", :bg-class \"bg-light\"}] [:div nil]], \"72\" [:div nil [:div [:p/markdown \"Now, let us do it in the index way.\"]]], \"54\" [:div nil [:div [:p/markdown \"Let us try this on some point in time.\"]]], \"41\" [:div [:p/code {:code \"(import java.util.TreeMap)\", :bg-class \"bg-light\"}] [:div [:p/code {:code \"java.util.TreeMap\\n\"}]]], \"65\" [:div nil [:div [:p/markdown \"## Measuring time\"]]], \"40\" [:div [:p/code {:code \"(require '[notespace.kinds :as kind]\\n         '[tablecloth.api :as tablecloth]\\n         '[tech.v3.datatype :as dtype]\\n         '[tech.v3.datatype.functional :as fun]\\n         '[tech.v3.datatype.datetime :as datetime]\\n         '[tech.v3.datatype.argops :as argops])\", :bg-class \"bg-light\"}] [:div nil]], \"71\" [:div [:p/code {:code \"(compute-with-time-measurement\\n (fn []\\n   (->> ds\\n        :datetime\\n        (dtype/emap (fn [datetime]\\n                      (let [row-numbers (row-numbers-of-last-few-days-by-argfilter\\n                                         datetime\\n                                         5)]\\n                        (-> ds\\n                            (tablecloth/select-rows row-numbers)\\n                            :x\\n                            fun/mean)))\\n                    :float64)\\n        fun/standard-deviation)))\", :bg-class \"bg-light\"}] [:div [:p/code {:code \"{:result 0.13710114362672973, :duration 33526}\\n\"}]]], \"64\" [:div [:p/code {:code \"(row-numbers-of-last-few-days-by-index\\n datetime20\\n 5)\", :bg-class \"bg-light\"}] [:div [:p/code {:code \"#object[java.util.AbstractMap$2 0x15fa69f6 \\\"[17, 18, 19, 20]\\\"]\\n\"}]]], \"52\" [:div nil [:div [:p/markdown \"First, let us do it using `argfilter`. We will use milliseconds arithmetic, though we could work directly with datetimes.\"]]]}}");
     document.getElementById("loading").remove();
    </script>
</html>
